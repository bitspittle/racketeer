title: Do Crimes
icons:
  cash: "💰"
  influence: "🤝"
  luck: "🎲"
  undercover: "🥸"
  counter: "🔘"
  vp: "🌟"
numTurns: 20
initialHandSize: 5
initialCash: 0
initialInfluence: 0
initialLuck: 0
initialDeck:
  - Pickpocket 5
  - Rumormonger 3
cardTypes:
  # Ordered by how they should show up on a card, NOT alphabetically necessarily
  - Action
  - Treasure
  - Thief
  - Spy
  - Trickster
  - Cop
  - Legend

upgradeNames:
  cash: Dextrous
  influence: Artful
  luck: Lucky
  undercover: Undercover

rarities:
  - name: Common
    frequency: 4
  - name: Uncommon
    frequency: 3
  - name: Rare
    frequency: 2

tierFrequencies:
  - 5
  - 6
  - 7
  - 8
  - 9

shopSizes:
  - 3
  - 4
  - 5
  - 6
  - 7
shopPrices:
  - 5
  - 8
  - 11
  - 14
ratingScores:
  # Anything lower than the first score is D
  - 10 # C
  - 20 # B
  - 30 # A
  - 40 # S

globalActions:
  # yaml freaks out a bit about some characters (e.g. | or >, which it tries to interpret), so define non-symbol
  # versions of everything in case that helps avoid those cases without needing to wrap things in quotes
  - "def 'and? '$a '$b '(&& $a $b)"
  - "def 'or? '$a '$b '(|| $a $b)"
  - "def 'eq? '$a '$b '(= $a $b)"
  - "def 'ne? '$a '$b '(!= $a $b)"
  - "def 'lt? '$a '$b '(< $a $b)"
  - "def 'lte? '$a '$b '(<= $a $b)"
  - "def 'gt? '$a '$b '(> $a $b)"
  - "def 'gte? '$a '$b '(>= $a $b)"
  - def 'game-add! '$property '$amount '(game-set! $property '(+ $it $amount))
  - def 'game-sub! '$property '$amount '(game-set! $property '(- $it $amount))
  - def 'card-add! '$card '$property '$amount '(card-set! $card $property '(+ $it $amount))
  - def 'card-sub! '$card '$property '$amount '(card-set! $card $property '(- $it $amount))
  - def 'if-true '$cond '$expr '(if $cond $expr _)
  - def 'if-false '$cond '$expr '(if $cond _ $expr)
  - def 'stop-if! '$cond '(if $cond '(stop!) _)
  - def 'cancel-if! '$cond '(if $cond '(cancel!) _)
  - def 'ask? '$prompt '(= (single (choose --prompt icon-convert $prompt (list "Yes" "No") 1) _) "Yes")
  - def 'card-has-any-of-types? '$card '$types '(any? (card-get $card 'types) '(in? $types $it))
  - def 'card-has-all-types? '$card '$types '(all? (card-get $card 'types) '(in? $types $it))
  - def 'card-upgrade-count '$card '(count (list (card-has-upgrade? $card 'cash) (card-has-upgrade? $card 'influence) (card-has-upgrade? $card 'luck) (card-has-upgrade? $card 'undercover)) '(= $it true))
  - def 'card-has-any-upgrade? '$card '(gt? (card-upgrade-count $card) 0)
  - def 'card-named '$name '(single (filter $all-cards '(= card-get $it 'name $name)) _)


cards:
  # TIER 1

  - name: Constable
    tier: 0
    types: [cop]
    flavor: Do nothing.

  - name: Rumormonger
    tier: 0
    types: [spy]
    flavor: Gain &.
    playActions:
      - game-add! 'influence 1

  - name: Pickpocket
    tier: 0
    types: [thief]
    flavor: Gain $.
    playActions:
      - game-add! 'cash 1

  - name: Fool's Gold
    tier: 0
    rarity: 1
    types: [action]
    cost: 2
    flavor: Gain 4$. Jail this card.
    playActions:
      - game-add! 'cash 4
      - pile-move-to! $jail $this

  - name: Squealer
    tier: 0
    rarity: 1
    types: [spy]
    cost: 3
    flavor: Gain 2&. You may jail up to two cards on the Street.
    playActions:
      - game-add! 'influence 2
      - pile-move-to! $jail (choose --prompt "Choose cards to jail." $street .. 0 2)

  - name: Con Artist
    tier: 0
    rarity: 1
    types: [thief, spy]
    cost: 2
    flavor: Gain $. Gain &.
    playActions:
      - game-add! 'cash 1
      - game-add! 'influence 1


  - name: Burglar
    tier: 0
    rarity: 0
    types: [thief]
    cost: 3
    flavor: Gain 2$.
    playActions:
      - game-add! 'cash 2


  - name: Croupier
    tier: 0
    rarity: 1
    types: [thief]
    cost: 4
    flavor: Gain 2$. Gain 1%.
    playActions:
      - game-add! 'cash 2
      - game-add! 'luck 1

  - name: Scrounger
    tier: 0
    rarity: 1
    types: [trickster]
    cost: 4
    flavor: Draw two cards, then discard one.
    playActions: 
      - game-draw! 2
      - pile-move-to! $discard (choose --prompt "Choose a card to discard." $hand 1)

  - name: I Know a Guy
    tier: 0
    rarity: 2
    types: [action]
    cost: 4
    flavor: Gain a Burglar on top of your deck.
    playActions:
      - pile-copy-to! --pos 'front $deck (single (filter $all-cards '(= card-get $it 'name "Burglar")) _ )

  - name: Card Shark
    tier: 0
    rarity: 1
    types: [thief, trickster]
    cost: 5
    flavor: Draw a card. Gain 1$.
    playActions:
      - game-draw! 1
      - game-add! 'cash 1

  # TIER 2 (i.e. 1 when 0-indexed)

  - name: Cheese It!
    tier: 1
    rarity: 2
    types: [action]
    cost: 2
    flavor: Jail your hand.
    playActions:
      - pile-move-to! $jail $hand

  - name: Ditch the Goods
    tier: 1
    rarity: 1
    types: [action]
    cost: 3
    flavor: Discard your hand, then draw that many cards plus one.
    playActions:
      - set '$to-draw-count (size $hand)
      - pile-move-to! $discard $hand
      - game-draw! + 1 $to-draw-count

  - name: Schmoozer
    tier: 1 
    rarity: 1
    types: [spy, trickster]
    cost: 3
    flavor: Gain 2&. Draw a card, then discard a card.
    playActions: 
      - game-add! 'influence 2
      - game-draw! 1
      - pile-move-to! $discard (choose --prompt "Choose a card to discard." $hand 1)

  - name: Lady Thistledown
    tier: 1
    rarity: 1
    types: [spy, legend]
    cost: 3
    flavor: Give a Spy in your hand +1&.
    playActions:
      - set '$spies filter $hand '(card-has-type? $it 'spy)
      - stop-if! empty? $spies
      - card-upgrade! (choose --prompt "Choose a Spy to upgrade." $spies 1) 'influence

  - name: Cat the Burglar
    tier: 1
    rarity: 1
    types: [thief, legend]
    cost: 3
    flavor: Give a Thief in your hand +1$.
    playActions:
      - set '$thieves filter $hand '(card-has-type? $it 'thief)
      - stop-if! empty? $thieves
      - card-upgrade! (choose --prompt "Choose a Thief to upgrade." $thieves 1) 'cash

  - name: Roving Gambler
    tier: 1
    rarity: 0
    types: [thief, spy, trickster]
    cost: 3
    flavor: Gain $. Gain &. Gain %.
    playActions:
      - game-add! 'cash 1
      - game-add! 'influence 1
      - game-add! 'luck 1

  - name: Antique Tome
    tier: 1
    rarity: 1
    types: [treasure]
    cost: 3
    flavor: Draw a card.
    vp: 2
    playActions:
      - game-draw! 1

  - name: Grift
    tier: 1
    rarity: 2
    types: [action]
    cost: 4
    flavor: Gain 3&. Add a card from the shop to your deck. Jail this card.
    playActions:
      - game-add! 'influence 3
      - pile-move-to! --pos 'random $deck (choose --prompt "Choose a card to add to your deck." $shop 1)
      - pile-move-to! $jail $this

  - name: Sloppy Mugger
    tier: 1
    rarity: 1
    types: [thief]
    cost: 4
    flavor: Gain 3$. When you get this, add a Constable to your discard pile.
    initActions: 
      - pile-copy-to! $discard (single (filter $all-cards '(= card-get $it 'name "Constable")) _ )
    playActions:
      - game-add! 'cash 3


  - name: Embezzler
    tier: 1
    rarity: 0
    types: [thief, spy]
    cost: 4
    flavor: "Choose one: Gain 2$ or Gain 2&."
    playActions:
      - set '$choices (list "Gain 2$" "Gain 2&")
      - set '$chosen-index (index-of $choices single choose $choices 1 _)
      - if-true (= $chosen-index 0) '(game-add! 'cash 2)
      - if-true (= $chosen-index 1) '(game-add! 'influence 2)


  - name: Wanted Poster
    tier: 1
    rarity: 2
    types: [action]
    cost: 5
    flavor: Gain 3$. Add a random Legend to your discard pile. Jail this card.
    playActions:
      - game-add! 'cash 3
      - set '$all-legend-cards (filter $all-cards '(card-has-type? $it 'legend))
      - set '$random-legend (take --from 'random $all-legend-cards 1)
      - pile-copy-to! $discard $random-legend
      - pile-move-to! $jail $this

  - name: Double-Dealer
    tier: 1
    rarity: 1
    types: [trickster]
    cost: 6
    flavor: Draw two cards.
    playActions:
      - game-draw! 2

# TIER 3

  - name: Polished Gem
    tier: 2
    rarity: 1
    types: [treasure]
    cost: 2
    vp: 1
    flavor: This card gains +2*.
    playActions:
     - card-set! $this 'vp '(+ 2 $it)


  - name: Jade Ornament
    tier: 2
    rarity: 1
    types: [treasure]
    cost: 3
    flavor: This is worth * for each ten cards you own.
    passiveVp: / (size $owned) 10

  - name: Lucky Parole
    tier: 2
    rarity: 2
    types: [action]
    cost: 3
    flavor: Gain 3%. Put a card from Jail and a Constable into your hand.
    playActions:
      - game-add! 'luck 3
      - stop-if! empty? $jail
      - pile-move-to! $hand (choose --prompt "Choose a card to get out of jail." $jail 1)
      - pile-copy-to! $hand (single (filter $all-cards '(= card-get $it 'name "Constable")) _ )

  - name: Opal
    tier: 2
    rarity: 0
    types: [treasure]
    cost: 4
    vp: 4
    flavor: A luminous, iridescent stone.

  - name: Mime
    tier: 2
    rarity: 1
    types: [trickster]
    cost: 4
    flavor: When you play this, it becomes a copy of a card in your hand.
    playActions:
      - set '$copied-card (choose --prompt "Choose a card to copy." $hand 1)
      - card-remove! $this
      - pile-copy-to! $hand $copied-card

  - name: Joey Omaha
    tier: 3
    rarity: 2
    types: [trickster, legend]
    cost: 4
    flavor: Draw a card. Give a Trickster you own +1%.
    playActions:
      - game-draw! 1
      - stop-if! ! any? $owned '(card-has-type? $it 'trickster)
      - card-upgrade! (choose --prompt "Choose a Trickster to upgrade." (filter $owned '(card-has-type? $it 'trickster)) 1) 'luck

  - name: Secret Identity
    tier: 2
    rarity: 2
    types: [action]
    cost: 4
    flavor: Gain $$. Give a Thief, Spy, or Trickster in your hand "This isn't discarded at end of turn."
    gameActions:
      - game-add! 'cash 2
      - set $types list 'thief 'spy 'trickster
      - set $matches filter $hand '(card-has-any-type? $types)
      - stop-if empty? $matches
      - card-upgrade! (choose --prompt "Choose a card to upgrade." $matches 1) 'undercover

  - name: Swindler
    tier: 2
    rarity: 0
    types: [spy]
    cost: 5
    flavor: Draw a card. Gain 2&.
    playActions:
      - game-draw! 1
      - game-add! 'influence 2

  - name: Bounty Hunter
    tier: 2
    rarity: 1
    types: [thief]
    cost: 5
    flavor: Gain 2$. You may choose up to two cards from your deck to jail.
    playActions:
      - game-add! 'cash 2
      - pile-move-to! $jail (choose --prompt "Choose up to two cards to jail." $deck .. 0 2)

  - name: Guildmaster
    tier: 2
    rarity: 2
    types: [thief]
    cost: 6
    flavor: Gain 1$ for each Thief on the street.
    playActions:
      - game-add! 'cash count $street '(card-has-type? $it 'thief)

  - name: Turf Expansion
    tier: 2
    rarity: 1
    types: [action]
    cost: 6
    flavor: Set your hand size to 6. Jail this card.
    playActions:
     - game-set! 'hand-size 6
     - pile-move-to! $jail $this

  - name: Bank Robber
    tier: 2
    rarity: 0
    types: [thief]
    cost: 6
    flavor: Gain 3$.
    playActions:
      - game-add! 'cash 3

  - name: Hottie Mara
    tier: 2
    rarity: 2
    types: [spy]
    cost: 7
    flavor: Double your current &.
    playActions:
      - game-add! 'influence game-get 'influence

# TIER 4

  - name: Pawnbroker
    tier: 3
    rarity: 2
    types: [thief]
    cost: 4
    flavor: You may choose a card on the street to jail. Gain $ equal to its tier plus 2.
    playActions:
      - game-add! 'cash 2
      - set '$maybe-card-to-jail (choose --prompt "Choose up to one card to jail." $street .. 0 1)
      - stop-if! empty? $maybe-card-to-jail
      - set '$card-to-jail single $maybe-card-to-jail _
      - pile-move-to! $jail $card-to-jail
      - game-add! 'cash card-get $card-to-jail 'tier

  - name: Fence
    tier: 3
    rarity: 1
    types: [thief, trickster]
    cost: 4
    flavor: Gain 2$. Put all Treasures in your deck into your discard pile.
    playActions:
     - game-add! 'cash 2
     - set '$treasures-in-deck (filter $deck '(card-has-type? $it 'treasure))
     - pile-move-to! $discard $treasures-in-deck

  - name: Purse Snatcher
    tier: 3
    rarity: 2
    types: [thief]
    cost: 5
    flavor: Add a card from the shop and a Constable to your discard pile.
    playActions:
      - pile-move-to! $discard (choose --prompt "Choose a card to add to your discard pile." $shop 1)
      - pile-copy-to! $discard (single (filter $all-cards '(= card-get $it 'name "Constable")) _ )

  - name: Baby Teeth Nelson
    tier: 3
    rarity: 2
    types: [thief, legend]
    cost: 5
    flavor: Jail this card and all Cops you own. Gain $ for each.
    playActions:
      - set '$owned-cops (filter $owned '(card-has-type? $it 'cop))
      - set '$cash-gained + 1 (size $owned-cops)
      - pile-move-to! $jail $owned-cops
      - pile-move-to! $jail $this
      - game-add! 'cash $cash-gained


  - name: Gem Cutter
    tier: 3
    rarity: 1
    types: [thief, trickster]
    cost: 5
    flavor: Gain 2$. You may jail a Treasure from the street. This gains its *.
    playActions:
     - game-add! 'cash 2
     - set '$treasures-on-street (filter $street '(card-has-type? $it 'treasure))
     - stop-if! empty? $treasures-on-street
     - set '$maybe-card-to-jail (choose --prompt "Choose up to one treasure to jail." $treasures-on-street .. 0 1)
     - stop-if! empty? $maybe-card-to-jail
     - set '$card-to-jail single $maybe-card-to-jail _
     - card-add! $this 'vp (card-get $card-to-jail 'vp-total)
     - pile-move-to! $jail $card-to-jail

  - name: Silver Cuffs
    tier: 3
    rarity: 1
    types: [treasure]
    cost: 5
    flavor: This is worth * for each two cards in jail.
    passiveVp: / (size $jail) 2

  - name: Corrupt Bailiff
    tier: 3
    rarity: 1
    types: [spy]
    cost: 6
    flavor: Draw a card. You may spend &&&& to give this card ****.
    playActions:
      - game-draw! 1
      - stop-if! < game-get 'influence 4
      - set '$convert (ask? "Would you like to spend 4& to give this card 4*?")
      - stop-if! ! $convert
      - game-add! 'influence -4
      - card-set! $this 'vp '(+ 4 $it)


  - name: Three-Card Monte Dealer
    tier: 3
    rarity: 1
    types: [trickster]
    cost: 6
    flavor: Draw three cards, then discard one.
    playActions:
      - game-draw! 3
      - pile-move-to! $discard (choose --prompt "Choose a card to discard." $hand 1)

# TIER 5

  - name: The Friends We Made Along The Way
    tier: 4
    rarity: 2
    types: [treasure]
    cost: 4
    flavor: This is worth 2* for Legend you own.
    passiveVp: * 2 (size (filter $owned '(card-has-type? 'legend)))

  - name: Dirty Sergeant
    tier: 4
    rarity: 2
    types: [cop]
    cost: 4
    flavor: Draw a card for every Cop you own.
    playActions:
      - game-draw! size (filter $owned '(card-has-type? 'cop))

  - name: Lucky Emerald
    tier: 4
    rarity: 1
    types: [treasure]
    cost: 5
    vp: 5
    flavor: Gain 2%.
    playActions:
      - game-add! 'luck 2

  - name: Annie Doshan
    tier: 4
    rarity: 2
    types: [thief, spy, trickster, legend]
    cost: 6
    flavor: For each upgraded card you own, gain $, &, and %.
    playActions:
      - set '$num-upgraded-cards count $owned '(card-has-any-upgrade? $it)
      - game-add! 'cash $num-upgraded-cards
      - game-add! 'influence $num-upgraded-cards
      - game-add! 'luck $num-upgraded-cards

  - name: Jailbreak
    tier: 4
    rarity: 2
    types: [action]
    cost: 6
    flavor: Put any number of cards from Jail into your hand.
    playActions:
      - pile-move-to! $hand (choose --prompt "Choose cards to get out of jail." $jail .. 0 _)


  - name: Corner the Market
    tier: 4
    rarity: 2
    types: [action]
    cost: 7
    flavor: Set your hand size to 7. Jail this card.
    playActions:
     - game-set! 'hand-size 7
     - pile-move-to! $jail $this

  - name: Robber Baron
    tier: 4
    rarity: 0
    types: [thief]
    cost: 7
    flavor: Gain 5$.
    playActions:
      - game-add! 'cash 5

  - name: Left Sapphire Earring
    tier: 4
    rarity: 1
    types: [treasure]
    cost: 7
    vp: 6
    flavor: When you get this, also get a Right Sapphire Earring.
    initActions:
      - pile-copy-to! $discard card-named "Right Sapphire Earring"

  - name: Right Sapphire Earring
    tier: 4
    rarity: 1
    types: [treasure]
    cost: 0
    vp: 6
    flavor: It looks a lot like the left one.

  - name: Diamond
    tier: 4
    rarity: 0
    types: [treasure]
    cost: 8
    vp: 10
    flavor: It ain't for playin' baseball, that's for sure.

  - name: Ultimate Heist
    tier: 4
    rarity: 1
    types: [action]
    cost: 9
    flavor: Draw three cards.
    playActions: 
      - game-draw! 3
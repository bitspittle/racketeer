title: Do Crimes
icons:
  cash: "ðŸ’°"
  influence: "ðŸ¤"
  luck: "ðŸŽ²"
  vp: "ðŸŒŸ"
numTurns: 20
initialHandSize: 5
initialCash: 0
initialInfluence: 0
initialLuck: 0
initialDeck:
  - Pickpocket 5
  - Newsie 3
cardTypes:
  # Ordered by how they should show up on a card, NOT alphabetically necessarily
  - Action
  - Treasure
  - Cop
  - Thief
  - Spy
  - Trickster
  - Legend

upgradeNames:
  cash: Dextrous
  influence: Artful
  luck: Lucky
  undercover: Undercover

rarities:
  - name: Common
    frequency: 4
  - name: Uncommon
    frequency: 2
  - name: Rare
    frequency: 1

tierFrequencies:
  - 5
  - 6
  - 7
  - 8
  - 9

shopSizes:
  - 3
  - 4
  - 5
  - 6
  - 7

shopPrices:
  - 5
  - 8
  - 12
  - 15

rankings:
      - name: "D   Pickpocket"
        score: 0
      - name: "D+  Newsie"
        score: 10
      - name: "C-  Embezzler"
        score: 20
      - name: "C   Burglar"
        score: 30
      - name: "C+  Croupier"
        score: 40
      - name: "B-  Smuggler"
        score: 50
      - name: "B   Grifter"
        score: 60
      - name: "B+  Swindler"
        score: 70
      - name: "A-  Fence"
        score: 80
      - name: "A   Safecracker"
        score: 90
      - name: "A+  Purse Snatcher"
        score: 100
      - name: "S-  Bank Robber"
        score: 110
      - name: "S   Kingpin"
        score: 120
      - name: "S+  Annie Doshen"
        score: 130

globalActions:
  # yaml freaks out a bit about some characters (e.g. | or >, which it tries to interpret), so define non-symbol
  # versions of everything in case that helps avoid those cases without needing to wrap things in quotes
  - "alias '&& 'and?"
  - "alias '|| 'or?"
  - "alias '= 'eq?"
  - "alias '!= 'ne?"
  - "alias '< 'lt?"
  - "alias '<= 'lte?"
  - "alias '> 'gt?"
  - "alias '>= 'gte?"
  - def 'game-add! '$property '$amount '(game-set! $property '(+ $it $amount))
  - def 'game-sub! '$property '$amount '(game-set! $property '(- $it $amount))
  - def 'card-add! '$card '$property '$amount '(card-set! $card $property '(+ $it $amount))
  - def 'card-sub! '$card '$property '$amount '(card-set! $card $property '(- $it $amount))
  - def 'if-true '$cond '$expr '(if $cond $expr _)
  - def 'if-false '$cond '$expr '(if $cond _ $expr)
  - def 'stop-if! '$cond '(if $cond '(stop!) _)
  - def 'cancel-if! '$cond '(if $cond '(cancel!) _)
  - def 'ask? '$prompt '(= (single (choose --prompt icon-convert $prompt (list "Yes" "No") 1) _) "Yes")
  - def 'ask?! '$prompt '(= (single (choose --required _ --prompt icon-convert $prompt (list "Yes" "No") 1) _) "Yes")
  - def 'card-has-any-of-types? '$card '$types '(any? (card-get $card 'types) '(in? $types $it))
  - def 'card-has-all-types? '$card '$types '(all? (card-get $card 'types) '(in? $types $it))
  - def 'card-upgrade-count '$card '(count (list (card-has-upgrade? $card 'cash) (card-has-upgrade? $card 'influence) (card-has-upgrade? $card 'luck) (card-has-upgrade? $card 'undercover)) '(= $it true))
  - def 'card-has-any-upgrade? '$card '(gt? (card-upgrade-count $card) 0)
  - def 'card-named '$name '(single (filter $all-cards '(= card-get $it 'name $name)) _)
  - def 'compare-by-index '$list '$a '$b '(compare index-of $list $a index-of $list $b)
  - def 'pile-compare '$pileA '$pileB '(compare-by-index (list $hand $deck $discard $street $jail) $pileA $pileB)
  - def 'choose-across-piles '$prompt '$cards '$count '(run '(cancel-if! empty? $cards) '(choose --format $fmt-card-with-pile --prompt $prompt (sorted --with '(pile-compare card-pile $a card-pile $b) (sorted $cards)) $count))
  - set '$fmt-card-with-pile '(join-to-string --separator "" (list ";(" (pile-get (card-pile $it) 'name) ")"))
  - set '$fmt-card-with-cash '(join-to-string --separator "" (list (card-get $it 'name) ";(" (card-get $it 'cost) (icon-convert "$") ")"))

cards:
  # TIER 1

  - name: Constable
    tier: 0
    types: [cop]
    flavor: Do nothing.

  - name: Newsie
    tier: 0
    types: [spy]
    flavor: Gain &.
    playActions:
      - game-add! 'influence 1

  - name: Pickpocket
    tier: 0
    types: [thief]
    flavor: Gain $.
    playActions:
      - game-add! 'cash 1

  - name: Counterfeit Cash
    tier: 0
    rarity: 1
    types: [action]
    cost: 2
    flavor: Gain $$$$. Jail this card.
    playActions:
      - game-add! 'cash 4
      - pile-move-to! $jail $this

  - name: Embezzler
    tier: 0
    rarity: 1
    types: [thief, spy]
    cost: 2
    flavor: Gain $ and &.
    playActions:
      - game-add! 'cash 1
      - game-add! 'influence 1

  - name: Vintage Brooch
    tier: 0
    rarity: 1
    types: [treasure]
    cost: 2
    flavor: Draw a card.
    vp: 2
    playActions:
      - game-draw! 1

  - name: Cheese It!
    tier: 0
    rarity: 1
    types: [action]
    cost: 2
    flavor: When you get this, jail two non-Cop cards you own. Burn this card.
    initActions:
      - pile-move-to! $jail $this
      - set '$ownednoncops filter $owned '(! (card-has-type? $it 'cop))
      - pile-move-to! $jail choose-across-piles "Choose two cards to jail." $ownednoncops 2

  - name: Burglar
    tier: 0
    rarity: 0
    types: [thief]
    cost: 2
    flavor: Gain $$.
    playActions:
      - game-add! 'cash 2

  - name: Squealer
    tier: 0
    rarity: 1
    types: [spy, cop]
    cost: 3
    flavor: Gain &&. You may jail a card on the Street.
    playActions:
      - game-add! 'influence 2
      - pile-move-to! $jail (choose --prompt "Choose up to one card to jail." $street .. 0 1)


  - name: Scrounger
    tier: 0
    rarity: 1
    types: [trickster]
    cost: 3
    flavor: Draw two cards, then discard one.
    playActions: 
      - game-draw! 2
      - stop-if! empty? $hand
      - pile-move-to! $discard (choose --required _ --prompt "Choose a card to discard." $hand 1)

  - name: I Know a Guy
    tier: 0
    rarity: 2
    types: [action]
    cost: 3
    flavor: Gain %. Create a Burglar on top of your deck.
    playActions:
      - game-add! 'luck 1
      - pile-copy-to! --pos 'front $deck (single (filter $all-cards '(= card-get $it 'name "Burglar")) _ )

  - name: Croupier
    tier: 0
    rarity: 1
    types: [thief, trickster]
    cost: 4
    flavor: Gain $$ and %.
    playActions:
      - game-add! 'cash 2
      - game-add! 'luck 1

  - name: Card Shark
    tier: 0
    rarity: 1
    types: [thief, trickster]
    cost: 4
    flavor: Draw a card. Gain $.
    playActions:
      - game-draw! 1
      - game-add! 'cash 1

  # TIER 2 (i.e. 1 when 0-indexed)

  - name: Social Climber
    tier: 1
    rarity: 1
    types: [spy]
    cost: 2
    flavor: Gain &&. Upgrades after one use.
    playActions:
      - game-add! 'influence 2
      - stop-if! card-has-upgrade? $this 'influence
      - card-upgrade! $this 'influence

  - name: Ditch the Goods
    tier: 1
    rarity: 1
    types: [action]
    cost: 3
    flavor: Discard four cards at random, then draw that many plus one.
    playActions:
      - set '$to-discard take --from 'random $hand 4
      - set '$to-draw-count (size $to-discard)
      - pile-move-to! $discard $to-discard
      - game-draw! + 1 $to-draw-count

  - name: Lady Thistledown
    tier: 1
    rarity: 2
    types: [spy, legend]
    cost: 3
    flavor: When you get or play this, give a Spy you own +&.
    initActions:
      - card-trigger! $this
    playActions:
      - set '$all-spies filter $owned '(card-has-type? $it 'spy)
      - set '$some-spies filter $all-spies '(! (card-has-upgrade? $it 'influence))
      - set '$spies filter $some-spies '(!= $it $this)
      - stop-if! empty? $spies
      - card-upgrade! (choose-across-piles "Choose a Spy to upgrade." $spies 1) 'influence

  - name: Cat the Burglar
    tier: 1
    rarity: 2
    types: [thief, legend]
    cost: 3
    flavor: When you get or play this, give a Thief you own +$.
    initActions:
      - card-trigger! $this
    playActions:
      - set '$all-thieves filter $owned '(card-has-type? $it 'thief)
      - set '$some-thieves filter $all-thieves '(! (card-has-upgrade? $it 'cash))
      - set '$thieves filter $some-thieves '(!= $it $this)
      - stop-if! empty? $thieves
      - card-upgrade! (choose-across-piles "Choose a Thief to upgrade." $thieves 1) 'cash

  - name: Roving Gambler
    tier: 1
    rarity: 0
    types: [thief, spy, trickster]
    cost: 3
    flavor: Gain $, &, and %.
    playActions:
      - game-add! 'cash 1
      - game-add! 'influence 1
      - game-add! 'luck 1

  - name: Gold Chain
    tier: 1
    rarity: 0
    types: [treasure]
    cost: 3
    vp: 3
    flavor: When you get this, it gains * for each other Gold Chain you own.
    initActions:
      - set '$num-chains count $owned '(= card-get $it 'name "Gold Chain")
      - card-set! $this 'vp '(+ 2 $num-chains)
#only adding 2 because it counts itself


  - name: Heiress
    tier: 1
    rarity: 1
    types: [thief]
    cost: 3
    flavor: Gain $$. Upgrades after one use.
    playActions:
      - game-add! 'cash 2
      - stop-if! card-has-upgrade? $this 'cash
      - card-upgrade! $this 'cash

# Not an exciting card. Fair bit of friction, perhaps reduced by GUI?
#
#  - name: Embezzler
#    tier: 1
#    rarity: 1
#    types: [thief, spy]
#    cost: 3
#    flavor: "Choose one: Gain $$ or Gain &&."
#    playActions:
#      - set '$choices (map (list "Gain $$." "Gain &&.") '(icon-convert $it))
#      - set '$chosen-index (index-of $choices single choose $choices 1 _)
#      - if-true (= $chosen-index 0) '(game-add! 'cash 2)
#      - if-true (= $chosen-index 1) '(game-add! 'influence 2)

  - name: Smuggler
    tier: 1
    rarity: 1
    types: [trickster]
    cost: 3
    flavor: Draw three cards. Jail this card.
    playActions:
      - game-draw! 3
      - pile-move-to! $jail $this

  - name: Art Forger
    tier: 1
    rarity: 1
    types: [thief, trickster]
    cost: 3
    flavor: Gain $$. You may reroll your shop with cards you own.
    playActions:
      - game-add! 'cash 2
      - stop-if! (! (ask? "Reroll your shop with cards you own?" ))
      - set '$cardnames (map $owned '(card-get $it 'name))
      - shop-reroll! '(in? $cardnames (card-get $card 'name))

  - name: Beat Cop
    tier: 1
    rarity: 1
    types: [cop]
    cost: 4
    flavor: When you get this, give 3 Thieves you own +$.
    initActions:
      - set '$all-thieves filter $owned '(card-has-type? $it 'thief)
      - set '$thieves filter $all-thieves '(! (card-has-upgrade? $it 'cash))
      - stop-if! empty? $thieves
      - card-upgrade! (choose-across-piles "Choose up to three Thieves to upgrade." $thieves .. 0 3) 'cash

  - name: Grifter
    tier: 1
    rarity: 1
    types: [spy, trickster]
    cost: 4
    flavor: Gain &&&. Add a card from the shop to your deck. Jail this card.
    playActions:
      - game-add! 'influence 3
      - stop-if! empty? $shop
      - pile-move-to! --pos 'random $deck (choose --format $fmt-card-with-cash --prompt "Choose a card to add to your deck." $shop 1)
      - pile-move-to! $jail $this

  - name: Gentleman Gerald
    tier: 1
    rarity: 2
    types: [cop, legend]
    cost: 4
    flavor: When you get this, gain seven &.
    initActions:
      - game-add! 'influence 7

  - name: Big Bill Murphy
    tier: 1
    rarity: 2
    types: [cop, legend]
    cost: 4
    flavor: Gain $$. You may convert all your $ to &.
    playActions:
      - game-add! 'cash 2
      - set '$convert (ask? "Would you like to convert your $ into &?")
      - stop-if! ! $convert
      - game-add! 'influence game-get 'cash
      - game-set! 'cash 0

  - name: Mickey the Mouth
    tier: 1
    rarity: 2
    types: [trickster, legend]
    cost: 5
    flavor: Draw a card. When you get this, gain %%%%%.
    initActions:
      - game-add! 'luck 5
    playActions:
      - game-draw! 1

  - name: Swindler
    tier: 1
    rarity: 0
    types: [spy]
    cost: 5
    flavor: Draw a card. Gain &&.
    playActions:
      - game-draw! 1
      - game-add! 'influence 2

  - name: Wanted Poster
    tier: 1
    rarity: 2
    types: [action]
    cost: 5
    flavor: Gain $$$. Add a random Legend to your discard pile. Jail this card.
    playActions:
      - game-add! 'cash 3
      - set '$all-legend-cards (filter $all-cards '(card-has-type? $it 'legend))
      # Force a choose screen so that the player can see what card they got
      - "set '$random-legend (choose --prompt \"Wanted: Dead or Alive\" --required _ (take --from 'random $all-legend-cards 1) 1)"
      - pile-copy-to! $discard $random-legend
      - pile-move-to! $jail $this

  - name: Double-Dealer
    tier: 1
    rarity: 1
    types: [trickster]
    cost: 6
    flavor: Draw two cards.
    playActions:
      - game-draw! 2

  - name: Hottie Mara
    tier: 1
    rarity: 2
    types: [spy, legend]
    cost: 7
    flavor: Gain 10 &.
    playActions:
      - game-add! 'influence 10


# TIER 3

  - name: Jade Ornament
    tier: 2
    rarity: 0
    types: [treasure]
    cost: 3
    flavor: This is worth * for each six cards you own.
    passiveVp: / (size $owned) 6

  - name: Polished Gem
    tier: 2
    rarity: 1
    types: [treasure]
    cost: 3
    vp: 1
    flavor: This card gains +**.
    playActions:
     - card-add! $this 'vp 2

  - name: Crime Wave
    tier: 2
    rarity: 2
    types: [action]
    cost: 3
    flavor: Discard your hand. Create that many Burglars in your hand.
    playActions:
      - set '$num-burglars size $hand
      - pile-move-to! $discard $hand
      - set '$burglarlist map (.. 1 $num-burglars) '(card-named "Burglar")
      - pile-copy-to! $hand $burglarlist

  - name: Lucky Parole
    tier: 2
    rarity: 2
    types: [action]
    cost: 3
    flavor: Gain %%. Put a card from jail and a Constable into your hand.
    playActions:
      - game-add! 'luck 2
      - stop-if! empty? $jail
      - pile-move-to! $hand (choose --prompt "Choose a card to get out of jail." $jail 1)
      - pile-copy-to! $hand (single (filter $all-cards '(= card-get $it 'name "Constable")) _ )

  - name: Opal
    tier: 2
    rarity: 0
    types: [treasure]
    cost: 4
    vp: 5
    flavor: A luminous, iridescent stone.

  - name: The Talented Mr. Tezuka
    tier: 2
    rarity: 2
    types: [thief, spy, legend]
    cost: 4
    flavor: Gain $$ and &&. Jail this after three uses.
    initActions:
      - card-set! $this 'counter 3 
    playActions:
      - game-add! 'cash 2
      - game-add! 'influence 2
      - card-sub! $this 'counter 1
      - stop-if! gt? (card-get $this 'counter) 0
      - pile-move-to! $jail $this

  - name: Mime
    tier: 2
    rarity: 1
    types: [trickster]
    cost: 4
    flavor: When you play this, it becomes an exact copy of a card in your hand.
    playActions:
      - cancel-if! empty? $hand
      - set '$copied-card (choose --prompt "Choose a card to copy." $hand 1)
      - card-remove! $this
      - pile-copy-to! $hand $copied-card

  - name: Fence
    tier: 2
    rarity: 1
    types: [trickster]
    cost: 3
    flavor: When you get or play this, shuffle the discard pile into the deck, then discard all Treasures in it.
    initActions:
      - card-trigger! $this
    playActions:
     - pile-move-to! $deck $discard
     - shuffle! $deck
     - set '$treasures-in-deck (filter $deck '(card-has-type? $it 'treasure))
     - pile-move-to! $discard $treasures-in-deck

  - name: Joey Omaha
    tier: 2
    rarity: 2
    types: [trickster, legend]
    cost: 4
    flavor: Draw a card. Give a Trickster you own +%.
    playActions:
      - game-draw! 1
      - set '$all-tricksters filter $owned '(card-has-type? $it 'trickster)
      - set '$some-tricksters filter $all-tricksters '(! (card-has-upgrade? $it 'luck))
      - set '$tricksters filter $some-tricksters '(!= $it $this)
      - stop-if! empty? $tricksters
      - card-upgrade! (choose-across-piles "Choose a Trickster to upgrade." $tricksters 1) 'luck

  - name: Ruthven Catsby, Esq.
    tier: 2
    rarity: 2
    types: [spy, legend]
    cost: 4
    flavor: Gain &&. You may convert all your & to $.
    playActions:
      - game-add! 'influence 3
      - set '$convert (ask? "Would you like to convert your & into $?")
      - stop-if! ! $convert
      - game-add! 'cash game-get 'influence
      - game-set! 'influence 0

  - name: Racketeer
    tier: 2
    rarity: 1
    types: [thief, trickster]
    cost: 4
    flavor: Gain $$. Gain %% if you own 20 or more cards.
    playActions:
      - game-add! 'cash 2
      - if-true (gte? (size $owned) 20) '(game-add! 'luck 2)

  - name: Baby Teeth Nelson
    tier: 2
    rarity: 1
    types: [thief, legend]
    cost: 5
    flavor: Jail this and all Cops you own. Draw a card for each.
    playActions:
      - set '$owned-cops (filter $owned '(card-has-type? $it 'cop))
      - pile-move-to! $jail $owned-cops
      - pile-move-to! $jail $this
      - game-draw! + 1 (size $owned-cops)

  - name: High Roller
    tier: 1
    rarity: 0
    types: [trickster]
    cost: 5
    flavor: Draw a card. Gain %.
    playActions:
      - game-draw! 1
      - game-add! 'luck 1

  - name: "'Velvet Thunder' Bauer"
    tier: 2
    rarity: 2
    types: [cop, legend]
    cost: 5
    flavor: When you get this, jail all Pickpockets and Newsies.
    initActions: 
      - pile-move-to! $jail filter $owned '(= card-get $it 'name "Pickpocket")
      - pile-move-to! $jail filter $owned '(= card-get $it 'name "Newsie")

  - name: Safecracker
    tier: 2
    rarity: 0
    types: [thief]
    cost: 5
    flavor: Gain $$$.
    playActions:
      - game-add! 'cash 3

  - name: The Pony Tack Bandit
    tier: 2
    rarity: 2
    types: [thief, trickster, legend]
    cost: 6
    flavor: Gain $$. You may reroll your shop with Treasures.
    playActions:
      - game-add! 'cash 2
      - stop-if! (! (ask? "Reroll your shop with Treasures?" ))
      - shop-reroll! '(card-has-type? $card 'treasure)

  - name: Turf Expansion
    tier: 2
    rarity: 1
    types: [action]
    cost: 6
    flavor: Set your hand size to 6. Burn this card.
    initActions:
     - shop-exclude! '(= card-get $card 'name "Turf Expansion")
    playActions:
     - game-set! 'hand-size 6
     - card-remove! $this

# TIER 4

  - name: Patrolman's Badge
    tier: 3
    rarity: 1
    types: [treasure]
    cost: 3
    flavor: This is worth * for every Cop you own.
    passiveVp: count $owned '(card-has-type? $it 'cop)

  - name: Gilded Cage
    tier: 3
    rarity: 1
    types: [treasure]
    cost: 3
    flavor: This is worth * for each three cards in jail.
    passiveVp: / (size $jail) 3

  - name: Pawnbroker
    tier: 3
    rarity: 2
    types: [thief]
    cost: 4
    flavor: You may choose a card on the street to jail. Gain $ equal to its tier plus 2.
    playActions:
      - set '$maybe-card-to-jail (choose --prompt "Choose up to one card to jail." $street .. 0 1)
      - game-add! 'cash 2
      - stop-if! empty? $maybe-card-to-jail
      - set '$card-to-jail single $maybe-card-to-jail _
      - pile-move-to! $jail $card-to-jail
      - game-add! 'cash + 1 card-get $card-to-jail 'tier

  - name: Purse Snatcher
    tier: 3
    rarity: 1
    types: [thief]
    cost: 5
    flavor: Add a card from the shop to your discard pile and a Constable to your hand.
    playActions:
      - stop-if! empty? $shop
      - pile-move-to! $discard (choose --format $fmt-card-with-cash --prompt "Choose a card to add to your discard pile." $shop 1)
      - pile-copy-to! $hand (single (filter $all-cards '(= card-get $it 'name "Constable")) _ )


  - name: Dirty Sergeant
    tier: 3
    rarity: 1
    types: [cop]
    cost: 4
    flavor: Draw three cards, then discard three cards. Gain $ for every Cop you own.
    playActions:
      - game-draw! 3
      - pile-move-to! $discard (choose --required _ --prompt "Discard three cards." $hand 3)
      - game-add! 'cash count $owned '(card-has-type? $it 'cop)

  - name: Gem Cutter
    tier: 3
    rarity: 1
    types: [thief, trickster]
    cost: 5
    flavor: Gain $$. You may jail a Treasure you own. This gains its *.
    playActions:
     - game-add! 'cash 2
     - set '$treasures-to-jail (filter $owned '(card-has-type? $it 'treasure))
     - stop-if! empty? $treasures-to-jail
     - set '$maybe-card-to-jail (choose-across-piles "Choose up to one treasure to jail." $treasures-to-jail .. 0 1)
     - stop-if! empty? $maybe-card-to-jail
     - set '$card-to-jail single $maybe-card-to-jail _
     - card-add! $this 'vp (card-get $card-to-jail 'vp-total)
     - pile-move-to! $jail $card-to-jail

  - name: Ruby
    tier: 3
    rarity: 0
    types: [treasure]
    cost: 6
    flavor: There's no place like home.
    vp: 7

  - name: Bank Robber
    tier: 3
    rarity: 1
    types: [thief]
    cost: 6
    flavor: Gain $$$$.
    playActions:
      - game-add! 'cash 4

  - name: Corrupt Bailiff
    tier: 3
    rarity: 1
    types: [spy, cop]
    cost: 6
    flavor: Draw a card. You may spend &&&& to give this card ****.
    playActions:
      - game-draw! 1
      - stop-if! < game-get 'influence 4
      - set '$convert (ask?! "Would you like to spend 4& to give this card 4*?")
      - stop-if! ! $convert
      - game-add! 'influence -4
      - card-add! $this 'vp 4

  - name: Hattie the Finder
    tier: 2
    rarity: 2
    types: [trickster, legend]
    cost: 6
    flavor: Choose a card from your deck or discard pile to put into your hand.
    playActions:
      - pile-move-to! $hand (choose-across-piles "Choose a card to put into your hand." (union $deck $discard) 1)

  - name: Mr. Big
    tier: 2
    rarity: 2
    types: [thief, legend]
    cost: 6
    flavor: Gain $ for each Thief on the street.
    playActions:
      - game-add! 'cash count $street '(card-has-type? $it 'thief)

  - name: Three-Card Monte Dealer
    tier: 3
    rarity: 1
    types: [trickster]
    cost: 7
    flavor: Draw three cards, then discard one.
    playActions:
      - game-draw! 3
      - stop-if! empty? $hand
      - pile-move-to! $discard (choose --required _ --prompt "Choose a card to discard." $hand 1)

# TIER 5

  - name: The Friends We Made Along The Way
    tier: 4
    rarity: 2
    types: [treasure]
    cost: 5
    flavor: This is worth ** for every Legend you own or in jail.
    passiveVp: * 2 (size (filter (union $owned $jail) '(card-has-type? $it 'legend)))

  - name: Lucky Emerald
    tier: 4
    rarity: 1
    types: [treasure]
    cost: 5
    vp: 5
    flavor: Gain %%.
    playActions:
      - game-add! 'luck 2

  - name: Old Gaffin
    tier: 4
    rarity: 2
    types: [thief, legend]
    cost: 5
    flavor: Gain $$. Whenever you play a Pickpocket or Burglar this turn, it gains *.
    playActions:
      - game-add! 'cash 2
      - fx-add! --desc icon-convert "Gain * whenever you play a Pickpocket or Burglar." '(if or? (= card-get $card 'name "Pickpocket") (= card-get $card 'name "Burglar") '(card-add! $card 'vp 1) _)

  - name: Annie Doshen
    tier: 4
    rarity: 2
    types: [thief, spy, trickster, legend]
    cost: 6
    flavor: Gain $, &, and %. This is worth * for each upgraded card you own.
    passiveVp: count $owned '(card-has-any-upgrade? $it)
    playActions:
      - game-add! 'cash 1
      - game-add! 'influence 1
      - game-add! 'luck 1

  - name: Jailbreak
    tier: 4
    rarity: 2
    types: [action]
    cost: 6
    flavor: Put up to three cards from Jail into your hand. Burn this card.
    playActions:
      - pile-move-to! $hand (choose --prompt "Choose cards to get out of jail." $jail .. 0 3)
      - card-remove! $this

  - name: Corner the Market
    tier: 4
    rarity: 1
    types: [action]
    cost: 7
    flavor: Set your hand size to 7. Burn this card.
    initActions:
     - shop-exclude! '(= card-get $card 'name "Turf Expansion")
     - shop-exclude! '(= card-get $card 'name "Corner the Market")
    playActions:
     - game-set! 'hand-size 7
     - card-remove! $this

  - name: Kingpin
    tier: 4
    rarity: 0
    types: [thief]
    cost: 7
    flavor: Gain $$$$$.
    playActions:
      - game-add! 'cash 5

  - name: Elegant Earrings
    tier: 4
    rarity: 1
    types: [treasure]
    cost: 7
    vp: 12
    flavor: Comes as a set of two Pearl Earrings worth 6 VP each.
    initActions:
      - pile-copy-to! $discard card-named "Pearl Earring"
      - pile-copy-to! $discard card-named "Pearl Earring"
      - card-remove! $this

  - name: Pearl Earring
    tier: 4
    rarity: 1
    types: [treasure]
    cost: 0
    vp: 6
    flavor: It looks a lot like the other one.

  - name: Diamond
    tier: 4
    rarity: 0
    types: [treasure]
    cost: 8
    vp: 10
    flavor: It ain't for playin' baseball, that's for sure.


  - name: Ultimate Heist
    tier: 4
    rarity: 1
    types: [action]
    cost: 10
    flavor: Draw three cards.
    playActions: 
      - game-draw! 3